<!DOCTYPE html>
<!-- v.0.0.2.5 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <title>base creator</title>
  <style>
    body {
      margin: 0;
      background-color: #000000;
      overflow: hidden;
    }
    canvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body onload="init();">
  <canvas id="0"></canvas>
  <script>
    "use strict";
    var _ge;
    function GE(v) {var t=typeof v;return document.getElementById(t===
"number"&&v>=v?(_ge=v+1)-1:t==="undefined"?v=_ge++:v);}
    var canvas = GE(0), ctx = canvas.getContext("2d");

    // press is touch or click

    // vX/vY = view x, y (position)
    // fX/fY = from x, y (start view position)
    // gX/gY = grab x, y (start press posistion)
    // sc = scale
    // cStart = press start
    var vX = 0, vY = 0, fX, fY, gX, gY, sc = 40, cStart = 0, tStart = 0,
      touch = null;

    function render() {
      return;
    }

    function press(x, y) {
      return console.log(x, y);
    }

    function init() {
      // settings: press time legth, precision, <-, 
      var pressLength = 350, clickP = 7, touchP = 13;

      function resizeWindow() {
        var  w = window.innerWidth, h = window.innerHeight;
        if (w > 4096 || h > 4096)
          if (w > h) {
            h = h * 4096 / w;
            w = 4096;
          } else {
            w = w * 4096 / h;
            h = 4096;
          }
        canvas.width = w;
        canvas.height = h;
        render();
      }

      resizeWindow();

      window.onresize = resizeWindow;

      canvas.onwheel = function (e) {
        if (!e.ctrlKey)
          return;
        var prev = sc, w = canvas.width / 2, h = canvas.height / 2;
        sc -= sc / e.deltaY * 10;
        vX = (vX - w) * sc / prev + w;
        vY = (vY - h) * sc / prev + h;
        e.preventDefault();
        render();
      };
      canvas.onmousedown = function (e) {
        cStart = Date.now();
        gX = e.pageX - canvas.offsetLeft;
        gY = e.pageY - canvas.offsetTop;
      }
      canvas.onmousemove = function (e) {
        if (!(e.buttons & 1))
          return;
        vX += e.movementX;
        vY += e.movementY;
        render();
      };
      canvas.onmouseup = function (e) {
        if (Date.now() > cStart + pressLength)
          return;
        var x = e.pageX - canvas.offsetLeft, y = e.pageY - canvas.offsetTop; 
        if (Math.abs(gX - x) > clickP && Math.abs(gY - y) > clickP)
          return;
        press(x, y);
      }

      function getTouch(e) {
        for (var ts = e.touches, l = ts.length; l-- > 0;)
          if (ts[l].identifier === touch.identifier)
            return touch = ts[l];
        return touch = null;
      };

      canvas.ontouchstart = function (e) {
        if (touch && !getTouch(e))
          return;
        tStart = Date.now();
        touch = e.changedTouches[0];
        fX = vX;
        fY = vY;
        gX = touch.pageX;
        gY = touch.pageY;
        e.preventDefault();
        render();
      };
      canvas.ontouchmove = function (e) {
        if (!getTouch(e))
          return;
        vX = fX + touch.pageX - gX;
        vY = fY + touch.pageY - gY;
        e.preventDefault();
        render();
      };
      canvas.ontouchend = canvas.ontouchcancel = function (e) {
        if (!getTouch({touches: e.changedTouches}))
          return;
        if (Date.now() > tStart + pressLength)
          return touch = null;
        console.log("?");
        var x = touch.pageX - canvas.offsetLeft,
          y = touch.pageY - canvas.offsetTop;
        touch = null;
        if (Math.abs(gX - x) > touchP && Math.abs(gY - y) > touchP)
          return;
        press(x, y);
      }

      document.body.removeAttribute("onload");
    }
  </script>
  <script type="text/javascript" src="voxorp-bases.js"></script>
</body>
</html>
