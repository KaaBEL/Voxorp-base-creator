<!DOCTYPE html>
<!-- v.0.0.2.8 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <title>base creator</title>
  <style>
    body {
      margin: 0;
      position: relative;
      background-color: #000000;
      overflow: hidden;
    }
    canvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body onload="init();">
  <canvas id="0"></canvas>
  <div style="position: absolute;color:white;top:0;">
    <div id="87"><span>Pie***l się</span></div>
    <div id="88"><span>Pie***l się</span></div>
    <div id="89"><span>Pie***l się</span></div>
    <div id="85" style="color:#59b"><span>Pie***l się</span></div>
  </div>
  <script>
    "use strict";
    var _ge;
    function GE(v) {var t=typeof v;return document.getElementById(t===
"number"&&v>=v?(_ge=v+1)-1:t==="undefined"?v=_ge++:v);}
    var canvas = GE(0), ctx = canvas.getContext("2d");

    // press is touch or click

    // vX/vY = view x, y (position)
    // fX/fY = from x, y (start view position)
    // gX/gY = grab x, y (start press posistion)
    // sc = scale
    // cStart = press start
    var vX = 0, vY = 0, fX, fY, gX, gY, sc = 40, cStart = 0, tStart = 0,
      touch = null, touch_2 = null;

    function render() {
      return;
    }

    function press(x, y) {
      return console.log(x, y);
    }

    function init() {
      // settings: press time legth, precision, <-, 
      var pressLength = 350, clickP = 7, touchP = 13;

      function resizeWindow() {
        var  w = window.innerWidth, h = window.innerHeight;
        if (w > 4096 || h > 4096)
          if (w > h) {
            h = h * 4096 / w;
            w = 4096;
          } else {
            w = w * 4096 / h;
            h = 4096;
          }
        canvas.width = w;
        canvas.height = h;
        render();
      }

      resizeWindow();

      window.onresize = resizeWindow;

      canvas.onwheel = function (e) {
        if (!e.ctrlKey)
          return;
        var prev = sc, w = canvas.width / 2, h = canvas.height / 2;
        sc -= sc / e.deltaY * 10;
        vX = (vX - w) * sc / prev + w;
        vY = (vY - h) * sc / prev + h;
        e.preventDefault();
        render();
      };
      canvas.onmousedown = function (e) {
        cStart = Date.now();
        gX = e.pageX - canvas.offsetLeft;
        gY = e.pageY - canvas.offsetTop;
      }
      canvas.onmousemove = function (e) {
        if (!(e.buttons & 1))
          return;
        vX += e.movementX;
        vY += e.movementY;
        render();
      };
      canvas.onmouseup = function (e) {
        if (Date.now() > cStart + pressLength)
          return;
        var x = e.pageX - canvas.offsetLeft, y = e.pageY - canvas.offsetTop; 
        if (Math.abs(gX - x) > clickP && Math.abs(gY - y) > clickP)
          return;
        press(x, y);
      }

      function getTouch(e) {
        for (var ts = e.touches, l = ts.length; l-- > 0;)
          if (ts[l].identifier === touch.identifier)
            return touch = ts[l];
        return touch = null;
      };
      
      function touchesStr(t) {
        var s = "[", list = 2, touchList = [t.touches, t.changedTouches];
        while (list--) {
          s += "[";
          for (var ts = touchList[list], i = ts.length; i-- > 0;)
            s += ts[i].identifier + ",";
              //+ ":" + (ts[i].pageX | 0) + "_" + (ts[i].pageY | 0) + ",";
          s = s.slice(0, -1) + "],";
        }
        return s.slice(0, -1);
      }

      /** @typedef {number} integer */
      /** @type {Array<TouchDat>} global touches */
      var tchs = [],
      /** @type {Array<number>} Touch.identifier-s of global touches */
        tIds = [];
      tchs.aDefaultHolder = -1;
  
      function TouchDat(touch) {
      /** @type {Touch} current touch source */
        this.src = touch;
      /** @type {integer} */
        this.x = Math.floor(touch.pageX - canvas.offsetLeft);
      /** @type {integer} */
        this.y = Math.floor(touch.pageY - canvas.offsetTop);
      /** @type {number} previous time touched
        this.p = Date.now();
      /** @type {number} allow default score */
        this.aDefault = 0;
      }

      console.error = (function () {var error = console.error;return function
() {for (var i = arguments.length, arr = [],
el = document.createElement("span"); i-- > 0;)arr[i] = arguments[i];
l.style.color = "#d11943";el.innerText = arr.join("");
GE(85).appendChild(el);error.apply(console, arr);};})();
      var logIdx = 0, prevClr = 0, clr = ["#ffffff", "#447c55", "#d11943"],
        logSrc;
      function spanLog(clrId, s) {
        if (logIdx && prevClr === clrId)
          return logSrc.childNodes[--logIdx].innerText += "s";
        var el = document.createElement("span");
        el.style.color = clr[prevClr = clrId];
        el.innerText = s;
        if (logSrc.childNodes[++logIdx])
          logSrc.replaceChild(el, logSrc.childNodes[logIdx - 1]);
        else
          logSrc.appendChild(el);
      }

      /** updates global touches to current
       * @param {0|1|2} typ type of touch event
       * @param {TouchEvent} touches
       */
      function updateTouches(typ, touches) {
        var c, el = GE(87 + typ);
        for (var i = 0, j, l, tStr = "global touches"; i < l;) {
          if ((j = tIds.indexOf(touches[i].identifier)) < 0)
            throw new Error("touch identifier not found within " + tStr);
          spanLog(tchs[j] === touches[i] << 1, j + ",]"[i + 1 < l]);
          tchs[j] = touches[i++];
        }
      }
      /** 
       * @param {0|1|2} typ type of touch event
       * 0: start, 1: move, 2: end|cancel
       * @param {TouchEvent} e
       */
      function checkTouches(typ, e) {
        logIdx = 0, logSrc = GE(87 + typ);
        if (typ === 0)
          updateTouches(typ, e.touches)
        if (typ === 1)
          spanLog(0, "[");
        /** i = index for changedTouches, j = index for tchs and tIds */
        var i = 0, j, l, tStr = "global touches", touches = e.changedTouches;
        // repeat for length happens only for touchstart or touch-end|cancel
        for (l = touches.length * (typ !== 1); i < l;) {
          if (typ === 0 ^ (j = tIds.indexOf(touches[i].identifier)) < 0)
            if (typ === 0) {
              console.error("index: " + j + " should not be within " + tStr);
              tchs[j] = new TouchDat(touches[i]);
            } else
              console.error("touch id: " + j + " is missing within " + tStr);
          else if (typ === 0) {
          // for touchstart // tchs[j] same as tchs[j] !== null
            for (j = 0; j < tchs.length && tchs[j];)
              j++;
            tIds.length = tchs.length += j >= touches.length;
            tchs[j] = new TouchDat(touches[i]);
            tIds[j] = touches[i].identifier;
          } else {
          // for touchend // !tchs[j] same as tchs[j] === null
            tchs[j] = null;
            tIds[j] = -1;
            while (j === tchs.length && !tchs[j])
              tIds.length = --tchs.length;
          }
        }
          spanLog(0, j + ",]"[++i < l]);
        if (typ !== 0)
          updateTouches(typ, e.touches)
      }

      canvas.ontouchstart = function (e) {
        
        GE(87).innerText = touchesStr(e);
        e.preventDefault();
        if (touch && getTouch(e))
          return;
        tStart = Date.now();
        touch = e.changedTouches[0];
        fX = vX;
        fY = vY;
        gX = touch.pageX;
        gY = touch.pageY;
        render();
      };
      canvas.ontouchmove = function (e) {
        GE(88).innerText = touchesStr(e);
        e.preventDefault();
        if (!getTouch(e))
          return;
        vX = fX + touch.pageX - gX;
        vY = fY + touch.pageY - gY;
        render();
      };
      canvas.ontouchend = canvas.ontouchcancel = function (e) {
        GE(89).innerText = touchesStr(e);
        if (!getTouch({touches: e.changedTouches}))
          return;
        GE(85).innerText = touchesStr(e) + Date.now();
        if (Date.now() > tStart + pressLength)
          return touch = null;
        console.log("?");
        var x = touch.pageX - canvas.offsetLeft,
          y = touch.pageY - canvas.offsetTop;
        touch = null;
        if (Math.abs(gX - x) > touchP && Math.abs(gY - y) > touchP)
          return;
        press(x, y);
      }

      document.body.removeAttribute("onload");
    }
  </script>
  <script type="text/javascript" src="voxorp-bases.js"></script>
</body>
</html>
